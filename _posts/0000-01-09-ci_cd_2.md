## Continuous integration and deployment I
### GitLab CI/CD

--

> Now that we have a good grasp on the premise of [continuous integration and deployment](#/7/1), we can take a look at how this works on GitLab.

> For GitLab, we simply need to add `.gitlab-ci.yml` to the root directory of the repository.

```bash
touch .gitlab-ci.yml
```

--

> At the top of this file we will add the following.

```yml
image: python:latest
```

> This will pull a Docker image with the latest version of Python installed.

--

> Next, we will check the version of Python and install the dependencies required for both CI and CD.

```yml
before_script:
  - python --version 
  - python -m pip install pytest pytest-black pytest-cov pytest-emoji pytest-pydocstyle
  - python -m pip install myst-parser numpy numpydoc sphinx sphinx-book-theme
```

--

> Then we can run our tests whenever a merge request is opened.

```yml
test:
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  script:
    - python -m pytest --verbose --black --emoji --pydocstyle --cov=mycosmo mycosmo
  only:
    refs:
      - merge_requests
```

> The crazy stuff after `coverage` simply formats the total coverage score. ğŸ˜µâ€ğŸ’«

<!-- .element: style="font-size: 50%;" -->

--

> The final step will be to build and deploy our API documentation.

```yml
pages:
  script:
    - sphinx-apidoc --module-first -feo docs/source mycosmo
    - sphinx-build docs/source docs/build
    - mv docs/build public/
  artifacts:
    paths:
      - public
  only:
      - main
```

--

## Exercise

> Push your workflow to the `main` branch, then open a new branch, implement any changes you like and open a MR. 

> Did your CI job run? 

> Merge your MR. 

> Did your CD job run? Can you see your API documentation?